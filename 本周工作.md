## 本周工作



### 备份恢复

1. 2.8.0版本发布上线

   - **监控线程和工作线程分离，解决：备份超时、备份时主备切换、备份占用过多空间预警三个问题**，实现：
     1. 备份超过12小时自动退出，不会出现前一天备份未完成的情况
     2. 备份期间主备切换后，会自动退出，避免白天在主库备份
     3. 备份时间长导致u01磁盘饱满，当u01空间小于50GB时自动退出。

2. 发现vipserver-c-client bug导致线上部分主机遇到调用vip获取列表时会hang住导致进程无法推进的问题，vipserver团队已经确认并发布测试版本修复。

3. **直传恢复CLI工具化**

   - 目前大家通过dboncosole.cm6 `direct_restore.py --help`查看相关信息，支持主库、备库直传备份。后续会通过dbfree提供portal界面。

   - ```reStructuredText
     $direct_restore.py --help

     直传任务生成脚本

     Usage:
         direct_restore.py --from=<from_inst> --to=<to_inst> [--master_backup] [--task_id=<tid>] [--action_id=<aid>] [--RUNNING_START | --RUNNING_SCHEDULE] [--parent_id=<pid>]

     Options:
         --from=<from_inst>          备份集从哪儿生成,必须是ip:port形式
         --to=<to_inst>              直传恢复的实例,必须是ip:port形式
         --master_backup             当需要主库备份时,请加上此选项,默认不在主库备份
         --task_id=<tid>             dbfree调用时使用 [default: -1]
         --action_id=<aid>           dbfree调用时使用 [default: -1]
         --parent_id=<pid>           dbfree调用时使用,可以将此任务加入到指定的任务组中
     ```

   - 5.6.16.10 backup lock功能测试，发现内核中缺少了`have_backup_lock` 变量，需要修改xtrabackup才能启用backup lock。

   - 恢复进程IO隔离方案开发中，预计本周内完成日常灰度，下周推送到线上。之后可以继续进行升级操作。

### Robocop自动运维系统

- Slave修复日常测试，本周内开始发布线上。
  - 第一个版本会修复1755, 1756, 1595三个Slave线程中断的情况，不涉及数据质量问题。
- 日常Slave自动修复推迟，原因：需要重建目前Slave中断的日常备库，然后统一接入。
- Optimize服务化delay
- Slave延迟告警处理 delay